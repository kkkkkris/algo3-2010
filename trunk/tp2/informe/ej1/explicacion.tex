Como contamos anteriormente, proponemos encontrar la subsecuencia unimodal máxima. Para generar tal subsecuencia hacemos la unión de dos subsecuencias de la secuencia original, la primera creciente y la segunda decreciente, de modo tal que el primer elemento de la secuencia decreciente sea el ultimo de la secuencia creciente. Esto ultimo genera una secuencia unimodal pero no una que sea máxima. Entonces, como restriccion pedimos que las subsecuencias crecientes y decrecientes sean máximas en largo. Es asi que buscamos las subsecuencias crecientes máximas y las subsecuencias decrecientes máximas (de ahora en mas $SCM$ y $SDM$) que contienen a un elemento dado tanto como primer o ultimo elemento respectivamente y guardar su largo. Luego con esa información, buscamos el elemento que la combinacion de la $SCM$ y la $SDM$ que terminan y comienzan en ese elemento sea máxima. Así es como obtenemos la unimodal máxima posible. Es necesario señalar que las combinaciones de $SCM$s y $SDM$s que terminan y comienzan en un elemento generan la subsecuencia unimodal maximal que tenga a ese elemento como máximo.
\newline 
Para llevar a cabo tal tarea la estructura elegida es una matriz de 3 x n que denominamos Tabla en el algoritmo para mayor claridad.
\newline
La Tabla almacena para cada fila i: 

hacer items: (agregar que down y up inician en 0)

en una columna el elemento  i de la secuencia, en otra el tamaño de la máxima subsecuencia creciente desde 1 hasta i que incluye al elemento i de la secuencia, y en la tercera , el tamaño de la máxima subsecuencia decreciente desde  i hasta n que incluye al elemento i de la secuencia.
\newline
Para mejor comprensión del pseudocódigo indexaremos la tabla como tabla[i][number/up/down] donde la columna number  tiene el elemento en si,la columna up el tamaño de máxima subsecuencia creciente y la columna down el tamaño de máxima subsecuencia decreciente. Llamamos $n$ al tamaño de la secuencia.
\newline
Pseudocódigo
\newline
$/*$función principal que calcula la cantidad mínima de elementos de una secuencia que hay que eliminar para que la subsecuencia resultante sea unimodal.$*/$
\begin{verbatim}
    calcularMin(Tabla t){
        para cada posicion i de la secuencia
            tabla[i][up] = maxSubsecuenciaCreciente(t,i)
        para cada posicion i de la secuencia (se recorre en orden inverso)
            tabla[i][down] = maxSubsecuenciaDecreciente(t,i)
        /* obtenemos el tamaño de la maxima subsecuencia unimodal*/   
        max = unimodalMax(t)     
        devolver n-max
}
\end{verbatim}

$/*$función que devuelve la maxima subsecuencia decreciene que contiene al element $i$ de $t$  $/*$

\begin{verbatim}                   
    maxSubsecuenciaCreciente(Tabla tabla,num i)    
        para j=i-1,j>0,j--                   O(i-1)
            si tabla[j][number] < tabla[i][number]
                m = maximo(tabla[i][up], tabla[j][up]) 	
        devolver m+1;
\end{verbatim}
notemos que maxSubsecuenciaDecreciente es analoga a maxSubsecuenciaCreciente.

$/*$La siguiente función una vez obtenidos los tamaños de máxima subsecuencia creciente y máxima subsecuencia decreciente realiza la búsqueda de la combinación de ambas que conforman la máxima subsecuencia unimodal y devuelve el tamaño de la misma.
Lo que hace es recorrer la tabla y para cada fila de la misma (con sus tres columnas number ,up y down) suma up y down y chequea si es mayor al max acumulador.
Finalmente ,resta uno al max obtenido ya que sumamos dos veces el "pico" de la subecuencia unimodal máxima ,ya que tanto up como down incluían a ese elemento. 

\begin{verbatim}
    unimodalMax(tabla t){
        res = 0 ;
        para cada posicion k de la tabla                    O(n)
            res = max(t[k][up]+t[k][down], res)
        max--
        devolver max
}
\end{verbatim}


Analicemos las complejidades de este algoritmo:

\begin{verbatim}
    calcularMin(Tabla t){
        para cada posicion i de la secuencia                   O(n^2)
            tabla[i][up] = maxSubsecuenciaCreciente(t,i)
        /* (se recorre en orden inverso) */
        para cada posicion i de la secuencia                   O(n^2)  
            tabla[i][down] = maxSubsecuenciaDecreciente(t,i)
        /* obtenemos el tamaño de la maxima subsecuencia unimodal*/   
        max = unimodalMax(t)                                   O(n)  
        devolver n-max
}                                                              ____
                                                        total  O(n^2)
\end{verbatim}

Como se observa en el pseudocódigo el algoritmo se compone de dos algoritmos de búsqueda de subsecuencia creciente y decreciente más larga. Ambos funcionan de forma analoga, por lo que de ahora en más vamos a analizar solo el algoritmo de busqueda de secuencia máxima creciente y concluir los mismos resultados para el otro.

Analizando la complejidad del algoritmo podemos ver dos O($n^{2}$) de las funciones maxSubsecuenciaCreciente y maxSubsecuenciaDecreciente, estos provienen de la siguiente sumatoria:

el primer ciclo hace

$\displaystyle\sum_{i=1}^n maxSubsecuenciaCreciente(t, i) = \sum_{i=1}^{n} i-1  = \frac{n(n-1)}{2} = O(n^{2})$

                       
Mostramos entonces que la complejidad de nuestro algoritmo es O($n^{2}$).




Sea $s$ una secuencia de enteros, definimos $l_i$ como la subsecuencia creciente máxima de $s_[1..i]$ que contiene al elemento $s_i$ ($l_i \in
  \{l_j ++ [s_i] / \exists j \in \mathbb{N}, j < i \land s_j < s_i\}$ y la función maxSubsecuenciaCreciente como la que de devuelve el tamaño de dicha $l_i$ para un $i$. Veamos que maxSubsecuenciaCreciente es correcta respecto de su especificación, para ello definimos una función recursiva analoga a maxSubsecuenciaCreciente. definida asi:\\
\\
    \centerline{$ \displaystyle maxCreciente(secu\ s, num\ i) = \max_{j \in A_i} maxCreciente(s, j) + 1$} 
    \centerline{tal que $A_i = \{ j \in \mathbb{N} / j < i \land s_j < s_i \}$}

Demostremos por induccion en i que $maxCreciente(s,i) = largo(l_i)$:

Caso base\\
i = 1 \\
\centerline{$\displaystyle maxCreciente(s, 1) = \max_{j \in A_1} (maxCreciente(s,j)) + 1$}
\centerline{$\displaystyle maxCreciente(s, 1) = \max_{j \in \emptyset} (maxCreciente(s,j)) + 1$}
\centerline{$\displaystyle maxCreciente(s, 1) = 1 = largo(s) = largo(l_1)$} 
Como queriamos ver.\\
\\
Paso Inductivo\\
Supongo que vale $\forall j \in \mathbb{N} / j < i$, quiero ver que para $i$. $(i > 1)$ vale:\\
\centerline{$\displaystyle maxCreciente(s, i) = \max_{j \in A_i} \{maxCreciente(s,j)\} + 1 \ \ \ (1)$}
Notemos que $ A_i \subset H = \{ j \in \mathbb{N} / j < i\} $ por lo que si vale para los elementos de $H$, tambien para los de $A_i$\\
Por hipótesis inductiva vale que:

$ \displaystyle \forall j \in A_i , maxCreciente(s,j) = largo(l_j) \\
 \Rightarrow \max_{j \in A_i} {maxCreciente(s,j)} = \max_{j \in A_i} {largo(l_j)} \\
 \Rightarrow \max_{j \in A_i} {maxCreciente(s,j) + 1} = \max_{j \in A_i} {largo(l_j) + 1}$ \\
Como $s_i  \notin l_j$
$\displaystyle \Rightarrow \max_{j \in A_i} {maxCreciente(s,j) + 1} = \max_{j \in A_i} {largo(l_j ++ [s_i])} \ \ \ (2)$ \\
Como $\forall j \in A_i,\ s_i > s_j$ entonces $l_j ++ [s_i]$  sigue siendo una secuencia creciente.\\
$\displaystyle \Rightarrow \max_{j \in A_i} {largo(l_j ++ [s_i])} = largo(l_i)\ \ \ (3) $ por propiedad descripta en el enunciado. \\ 
Por (1), (2) y (3)      
$\displaystyle \Rightarrow maxCreciente(s, i) = \max_{j \in A_i} {maxCreciente(s,j) + 1} = \max_{j \in A_i} {largo(l_j ++ [s_i])}$ \\
$\displaystyle \therefore maxCreciente(s, i) = largo(l_i) \blacksquare$ 

Una vez demostrado esto, mostremos que hallando la mejor combinación entre subsecuencia creciente y subsecuencia decreciente, obtenemos la subsecuencia unimodal óptima. 

%Es decir maxSecUnimodal = max(lu$_i$+ld$_i$)-1\hspace{0.1cm} $\forall$ i,j, $1\leq i<j\leq n$,S${_i} \not =$x${_j}$ 

Llamemos $SC_i$ a una subsecuencia creciente maxima para S[1..i] que incluye al elemento $S_i$ y $SD_i$ a una subsecuencia decreciente maxima para $S[i..n]$ que incluye al elemento $S_i$(puede haber más de una).

Llamemos $U_i$ a una subsecuencia unimodal que tiene al elemento $S_i$ como su pico máximo ****FALTA DEFINIR PICO MAXIMO***.
Tal que $U_i$ está formada por una combinación de $SC_i$ + fin($SD_i$),donde fin(s) devuelve s menos su primer elemento, ya que el último elemento de $SC_i$ y el primero de $SD_i$ son el mismo, en especial es el pico máximo. Entonces podemos ver que $U_i$ es máximal, no tengo forma de agregarle elementos (tanto de su parte izquierda como su parte derecha), tal que siga siendo unimodal. Pues si hubiera forma, $SC_i$ y $SD_i$ no seriam máximas.

Luego tomando el conjunto $M = \{U_i / i \in \mathbb{N} \land i \le largo(s)\}$, habremos obtenido el conjunto de todas las posibles subsecuencias unimodales máximales (toda secuencia tiene al menos un elemento). De este conjunto $M$ tomamos la $U_i$ que sea máxima en largo y habremos obtenido la subsecuencia unimodal máxima. Con lo cual queda demostrado que es correcto la concatenación de subsecuencias crecientes y decrecientes máximas(o mejor dicho la suma de sus longitudes) para formar la unimodal.
